#!/bin/bash

#Variaveis
FILE_SYSTEM_ID=fs-06409a8200831af8e.efs.us-east-1.amazonaws.com
EFS_MOUNT_POINT=/mnt/efs/wordpress
GIT_REPO_URL=https://github.com/PedroMarineli/wordpress.git
DB_HOST=wp-database.c8fk4ougqlv1.us-east-1.rds.amazonaws.com
DB_USER=admin
DB_PASSWORD=senha-segura
DB_NAME=wordpress

$Efs
sudo apt-get update
sudo apt-get install -y nfs-common
sudo mkdir -p /mnt/efs/wordpress
sudo mount -t nfs4 -o nfsvers=4.1 fs-06409a8200831af8e.efs.us-east-1.amazonaws.com:/ /mnt/efs/wordpress
sudo chown -R www-data:www-data /mnt/efs/wordpress
sudo chmod -R 755 /mnt/efs/wordpress

#Git
cd /
git clone $GIT_REPO_URL
cd /wordpress

#.env
cat > .env <<EOL
WORDPRESS_DB_HOST=$DB_HOST
WORDPRESS_DB_USER=$DB_USER
WORDPRESS_DB_PASSWORD=$DB_PASSWORD
WORDPRESS_DB_NAME=$DB_NAME
WORDPRESS_CONFIG_EXTRA="
define('WP_HOME', 'http://' . \\\$_SERVER['HTTP_HOST']);
define('WP_SITEURL', 'http://' . \\\$_SERVER['HTTP_HOST']);
"
EOL

#Iniciar containers
sudo docker-compose up -d



